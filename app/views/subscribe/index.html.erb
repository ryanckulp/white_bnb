<%= render partial: "shared/heading", locals: { title: 'Start Trial', description: "Subscribe to #{Rails.application.credentials.company_name}." } %>

<div id="checkout">
  <!-- Checkout will insert the payment form here -->
</div>

<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
const stripe = Stripe('<%= Rails.application.credentials.stripe&.publishable_key || '' %>');

initialize();

// Create a Checkout Session as soon as the page loads
async function initialize() {
  const response = await fetch("/billing_portal.json", {
    method: 'POST'
  });

  const { clientSecret } = await response.json();

  const checkout = await stripe.initEmbeddedCheckout({
    clientSecret,
  });

  // Mount Checkout
  checkout.mount('#checkout');
}
</script>

<% if ScriptTag.enabled.exists?(name: 'Rewardful') %>
<script>
  rewardful('convert', { email: '<%= current_user.email %>' })
</script>
<% end %>
